@use "../mixins/theming";
@use "../variables" as theme;
@use "../mixins/collapsible";
@use "../mixins/link";

body > header nav.collapsible {
  @include collapsible.collapsible;

  &.collapsed {
    /* Menu below breakpoint */
    button.collapsible-toggle {
      order: 1;
      margin-left: auto;
      border: 0;
      @include theming.apply-from-theme(
        (
          background-color: theme.$header-navigation-collapsible-button-background-color,
          font-size: theme.$header-navigation-collapsible-button-font-size,
          height: theme.$header-navigation-collapsible-button-height,
          min-height: theme.$header-navigation-collapsible-button-min-height,
          min-width: theme.$header-navigation-collapsible-button-min-width,
          width: theme.$header-navigation-collapsible-button-width,
        )
      );
      gap: 0;

      &::before {
        @include theming.apply-from-theme(
          (
            content: theme.$header-navigation-collapsible-icon,
            font-size: theme.$header-navigation-collapsible-icon-font-size,
            color: theme.$header-navigation-collapsible-icon-color,
          )
        );
        line-height: initial;
        background-color: transparent;
      }

      &[aria-expanded="true"]::before {
        @include theming.apply-from-theme(
          (
            content: theme.$header-navigation-collapsible-icon-collapsed,
            font-size: theme.$header-navigation-collapsible-icon-collapsed-font-size,
            color: theme.$header-navigation-collapsible-icon-color,
          )
        );
      }

      &[aria-expanded="true"] {
        /* Element that will be collapsed */
        + .collapsing-element {
          @include theming.apply-from-theme(
            (
              flex-direction: theme.$header-navigation-collapsible-flex-direction,
              justify-content: theme.$header-navigation-collapsible-justify-content,
              gap: theme.$header-navigation-collapsible-gap,
              max-width: theme.$header-navigation-collapsible-max-width,
              width: theme.$header-navigation-collapsible-width,
              z-index: theme.$header-navigation-collapsible-z-index,
              padding-top: theme.$header-navigation-collapsible-padding-top,
              padding-right: theme.$header-navigation-collapsible-padding-right,
              padding-bottom: theme.$header-navigation-collapsible-padding-bottom,
              padding-left: theme.$header-navigation-collapsible-padding-left,
              border-width: theme.$header-navigation-collapsible-border-width,
              border-style: theme.$header-navigation-collapsible-border-style,
              border-color: theme.$header-navigation-collapsible-border-color,
              background-color: theme.$header-navigation-collapsible-background-color,
              color: theme.$header-navigation-collapsible-text-color,
              -webkit-box-shadow: theme.$header-navigation-collapsible-box-shadow,
              box-shadow: theme.$header-navigation-collapsible-box-shadow,
              top: theme.$header-navigation-collapsible-top,
              left: theme.$header-navigation-collapsible-left,
              right: theme.$header-navigation-collapsible-right,
            )
          );
          max-height: initial;
          height: auto;
          box-sizing: border-box;
          position: absolute;

          ul,
          ol {
            display: flex;
            flex-direction: column;
            width: 100%;
            margin: 0;
            padding: 0;
            @include theming.apply-from-theme(
              (
                gap: theme.$header-navigation-collapsible-list-gap,
                background-color: theme.$header-navigation-collapsible-list-background-color,
              )
            );

            li {
              display: flex;
              @include theming.apply-from-theme(
                (
                  align-items: theme.$header-navigation-collapsible-list-item-align-items,
                  background-color: theme.$header-navigation-collapsible-list-item-background-color,
                  color: theme.$header-navigation-collapsible-list-item-text-color,
                  border-width: theme.$header-navigation-collapsible-list-item-border-width,
                  border-style: theme.$header-navigation-collapsible-list-item-border-style,
                  border-color: theme.$header-navigation-collapsible-list-item-border-color,
                  padding-top: theme.$header-navigation-collapsible-list-item-padding-top,
                  padding-right: theme.$header-navigation-collapsible-list-item-padding-right,
                  padding-bottom: theme.$header-navigation-collapsible-list-item-padding-bottom,
                  padding-left: theme.$header-navigation-collapsible-list-item-padding-left,
                )
              );
              width: 100%;

              &::before {
                display: none;
                /* Preventing default nav before to show up */
              }

              &:last-child {
                @include theming.apply-from-theme(
                  (
                    border-width: theme.$header-navigation-collapsible-list-item-last-item-border-width,
                  )
                );
              }

              &:first-child {
                @include theming.apply-from-theme(
                  (
                    border-width: theme.$header-navigation-collapsible-list-item-first-item-border-width,
                  )
                );
              }

              a {
                width: 100%;
                max-width: 100%;
                padding: 0;
                box-sizing: border-box;
                @include theming.apply-from-theme(
                  (
                    text-decoration: theme.$header-navigation-collapsible-list-item-link-text-decoration,
                    justify-content: theme.$header-navigation-collapsible-list-item-link-justify-content,
                    background-color: theme.$header-navigation-collapsible-list-item-link-background-color,
                    color: theme.$header-navigation-collapsible-list-item-link-text-color,
                    padding-top: theme.$header-navigation-collapsible-list-item-link-padding-top,
                    padding-right: theme.$header-navigation-collapsible-list-item-link-padding-right,
                    padding-bottom: theme.$header-navigation-collapsible-list-item-link-padding-bottom,
                    padding-left: theme.$header-navigation-collapsible-list-item-link-padding-left,
                  )
                );
                border: 0;
                white-space: nowrap;

                &[aria-current] {
                  @include link.link-and-icon-styling(
                    "header-navigation-collapsible-list-item-link-selected-"
                  );
                }
              }

              &:hover {
                @include theming.apply-from-theme(
                  (
                    background-color: theme.$header-navigation-collapsible-list-item-link-hover-background-color,
                    color: theme.$header-navigation-collapsible-list-item-hover-text-color,
                    text-decoration: theme.$header-navigation-collapsible-list-item-hover-text-decoration,
                  )
                );

                a {
                  @include theming.apply-from-theme(
                    (
                      background-color: theme.$header-navigation-collapsible-list-item-link-hover-background-color,
                      color: theme.$header-navigation-collapsible-list-item-link-hover-text-color,
                    )
                  );

                  &:visited {
                    @include theming.apply-from-theme(
                      (
                        background-color: theme.$header-navigation-collapsible-list-item-link-hover-background-color,
                      )
                    );
                  }
                }
              }

              &[aria-current] {
                @include link.link-and-icon-styling(
                  "header-navigation-collapsible-list-item-link-selected-"
                );
              }
            }
          }
        }
      }
    }
  }

  /* collapsible menu button.
  /* This button is only visisble when javascript is loaded. */
  /* Do not add the button to the html manually, JS will do this. */
  /* When JS isn't available the menu will be opened by default for accessibility. */
  button.collapsible-toggle {
    /* JS menu collapsed behaviour */
    &[aria-expanded="false"] {
      & ~ * {
        display: flex;
      }
    }
  }
}
